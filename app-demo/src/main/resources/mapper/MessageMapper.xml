<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="cn.edu.dgut.school_helper.mapper.MessageMapper">

	<resultMap
		type="cn.edu.dgut.school_helper.pojo.dto.MessageDTO" id="allMessage">
		<id property="messageId" column="message_id"/>
		<result property="openId" column="open_id"/>
		<result property="content" column="content"/>
		<result property="date" column="date"/>
		<result property="status" column="status"/>
		<result property="replyId" column="reply_id"/>
		<result property="fromOpenName" column="from_open_name"/>
		<result property="toOpenName" column="to_open_name"/>
	</resultMap>
	<select id="selectAllMessageByOpenId" resultMap="allMessage">
		SELECT m.*,u1.nickname 'from_open_name',u2.nickname
		'to_open_name' from message m
		LEFT JOIN reply r
		on m.reply_id = r.reply_id
		LEFT JOIN user u1
		on r.from_open_id = u1.open_id
		LEFT JOIN user u2
		on r.to_open_id = u2.open_id
		WHERE m.open_id = #{openId} and m.status != 3;
	</select>
</mapper>
